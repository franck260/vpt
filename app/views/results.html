$def with (entity)

$code:
    # Définition des methodes partagées
    show_user = lambda result: result.user.pseudo
    show_attended = lambda result: result.attended
    show_buyin = lambda result: formatting.append(result.buyin, " €")
    show_rank = lambda result: formatting.append(result.rank, lambda s: "er" if s == 1 else "e")
    show_profit = lambda result: formatting.append(result.profit, " €")
    show_net_profit = lambda result: formatting.append(result.net_profit, " €")
    show_score = lambda result: result.score
    
    # Définition des champs par type d'entité
    _fields =    { "Tournament" : [("Joueur",          show_user),
                                   ("Mise",            show_buyin),
                                   ("Classement",      show_rank),
                                   ("Gain",            show_profit),
                                   ("Gain net",        show_net_profit),
                                   ("Points",          show_score)
                                  ],
                                  
                   "Season"     : [("Classement",      show_rank),
                                   ("Joueur",          show_user),
                                   ("Points",          show_score),
                                   ("Participations",  show_attended),
                                   ("Mise totale",     show_buyin),
                                   ("Gain total",      show_profit),
                                   ("Gain net total",  show_net_profit)
                                  ]
                 } 
    


$def show_results():
    $ filtered_results = filter(lambda result: result.actual, entity.results)
    $if not filtered_results:
        <i>Pas encore de données enregistrées !</i>
    $else:
        $ fields=_fields[class_name(entity)]
        $ headers=zip(*fields)[0]
        $ formatters=zip(*fields)[1]
        <table class="results">
            <tr>
                $for header in headers:
                    <th><b>$header</b></th>     
            </tr>
            $for result in filtered_results:
                <tr>
                $for formatter in formatters:
                    <td>$formatter(result)</td>
                </tr>
        </table> 

<p>
$:show_results()
</p>